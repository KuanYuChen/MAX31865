[Micropython]TPYBoardV201 温湿度上传
=======================================

版权声明：翻译整理属于TPYBoard，转载时请以超链接形式标明文章原始出处和作者信息及本声明 


历来关于温湿度的检测都是没有间断过的，这次我们继续检测温湿度，同样还是使用DHT11来检测。但是这次检测到的温湿度不进行显示，也不进行报警，这次要把检测到的数据通过以太网上传到服务器上去。

先来说一下需要的器件：

    TPYBoardV201开发板一块；
    DHT11温湿度模块一个；
    面包板一个（可省略）；
    杜邦线若干；
    先来简单介绍一下各个器件。

    TPYBoardV201开发板

TPYBoardV201是以遵照MIT许可的MicroPython为基础，由TurnipSmart公司制作的一款MicroPython开发板，它基于STM32F405单片机，通过USB接口进行数据传输。该开发板内置4个LED灯、板载V201网口功能，可在3.3V-10V之间的电压正常工作。可以说这个开发板在网络稳定方面是一霸也不为过，板上其他硬件资源也非常丰富，像单总线，i2c，spi，串口等接口也是应有尽有，这次我们就要用到串口和单总线的功能。

    DHT11

    DHT11数字温湿度传感器是一款含有已校准数字信号输出的温湿度复合传感器，它应用专用的数字模块采集技术和温湿度传感技术，确保产品具有极高的可靠性和卓越的长期稳定性。传感器包括一个电阻式感湿元件和一个NTC测温元件，并与一个高性能8位单片机相连接。

    上面介绍了所需器件，下面我们来说一下实验所需的环境。这里只需要能给开发板供电，以及可以支持有线网络连接（可以给开发板接上网线）即可。

    下面实验开始

一.按照下表进行接线
----------------------

	+-----------+-------------+
	| DHT11V201 | 开发板      |
	+===========+=============+
	| GND       | GND         |
	+-----------+-------------+
	| VCC       | VIN         |
	+-----------+-------------+
	| DATA      | X8          |
	+-----------+-------------+

    其次就是给开发板进行供电和插上网线，看到V201网口上的绿色指示灯亮起来，说明已经连接上网络。

二.配置V201网口
-------------------

    这一步是为了设置V201网口模块的目的地址，本地端口，波特率，数据位，校验位等一系列信息，具体配置方向详见：V201网口配置使用文档。

    接着我们来说一下基本的逻辑流程：

    我们这次是为了把温湿度数据上传服务器，第一步肯定是现在开发板上获取到温湿度的数据，关于DHT11的使用，开发板这边提供了非常详细的使用方法和DHT11的库，这里就不做多余介绍啦。

    在我们成功获取到温湿度以后，把温湿度数据进行分割处理，说白了就是把温度和湿度分开。

    前面把要传的数据都处理好了，接下来就是进行传输，在保证网络通畅的前提下，设置串口6，也就是Y1和Y2，具体的波特率这个要参照你前面设置给V201网口的波特率来定。

    在这里需要说一句的是，这个开发板在使用以太网功能的时候，Y1，Y2，Y3这三个引脚是被占用的，其中Y1和Y2是串口，执行通信功能。

    这里需要介绍一下Y3，Y3是V201网口的设置引脚，当Y3不为低电平时，V201网口处于正常工作状态，可以进行数据上传，也可以利用设置软件通过网络进行配置。当Y3为低电平时，V201网口进入串口配置模式，可利用设置软件通过串口进行配置，此时不能进行数据上传。

    以上工作全部完成后，剩下的就是把配置好的数据，通过串口6发送出去。

    最后我们只需要监控数据是不是上传正常就可以了。

    下面是我做实验的实物图和数据监控截图，我是在我的电脑上开了个模拟的端口，虽然low了点，但是效果一样的。


.. image:: http://www.micropython.net.cn/ueditor/php/upload/image/20170415/1492220610497650.jpg

实物图

.. image:: http://www.micropython.net.cn/ueditor/php/upload/image/20170415/1492220644727630.png

数据监控截图

源代码
----------

下面是源代码，共享给大家。

.. code-block:: python

	import pyb
	from pyb import UART
	from pyb import Pin
	from ubinascii import hexlify
	from ubinascii import *
	from DHT11 import DHT11#定义温湿度传感器的库
	  
	ulan = UART(6, 115200)#定义串口，我的网口设置了115200的波特率
	K=1
	#*******************************主程序**********************************
	print('while')
	while (K>0):
		S=DHT11()#调用温湿度传感器的方法
		A=S.read_temps()#读取温湿度的值
		print('A:',A)
		print('A:',A[0:2])
		print('A:',A[3:5])#打印温湿度的值
		ulan.write('temperature is:'+A[0:2]+'\r\n')#上传温度
		pyb.delay(2000)#做延时是为了让给模拟服务器一个反应时间
		ulan.write('wet is:'+A[3:5]+'%'+'\r\n')#上传湿度
		pyb.delay(12000)
